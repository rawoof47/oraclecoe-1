<app-navbar></app-navbar>

<app-page-banner
  [pageTitle]="'Applied Jobs'"
  [backgroundImage]="'img/page-title-bg.jpg'"
></app-page-banner>

<div class="dashboard-area ptb-100">
  <div class="container">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-lg-4 col-md-12">
        <!-- (Optional) Insert sidebar content here -->
      </div>

      <!-- Applied Jobs -->
      <div class="col-lg-8 col-md-12">
        <!-- Header with stats -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="dashboard-heading">Your Applications</h2>
          <span class="badge badge-pill badge-light">
            {{ appliedJobPosts.length }} Applied Jobs
          </span>
        </div>

        <!-- Error Message -->
        <div *ngIf="error" class="alert alert-danger alert-dismissible fade show">
          {{ error }}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <!-- Jobs List -->
        <ng-container *ngIf="!loading && appliedJobPosts.length > 0; else noJobs">
          <div class="job-listings">
            <article
              *ngFor="let job of appliedJobPosts"
              class="card mb-3 border-0 shadow-sm"
            >
              <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start">
                  <!-- Job Info + Link -->
                  <div class="flex-grow-1">
                    <a
                      [routerLink]="['/job-details', job.id]"
                      class="d-block text-decoration-none text-body mb-2"
                    >
                      <h3 class="h5 font-weight-bold mb-1">{{ job.job_title }}</h3>
                      <div class="text-muted small">Job ID: {{ job.id }}</div>
                    </a>

                    <!-- Withdraw Button -->
    <button *ngIf="!job.withdrawn" 
            (click)="withdrawApplication(job.application_id)"
            class="btn btn-outline-danger btn-sm mt-2">
      <i class="fas fa-times mr-1"></i> Withdraw Application
    </button>
    
    <!-- Withdrawn label -->
    <span *ngIf="job.withdrawn" class="badge badge-secondary mt-2">
      <i class="fas fa-ban mr-1"></i> Withdrawn
    </span>
  </div>
  <!-- Status Badge - Updated to show proper status -->
  <span class="badge badge-pill align-self-start"
        [ngClass]="{
          'badge-success': !job.withdrawn,
          'badge-secondary': job.withdrawn
        }">
    <i class="fas mr-1"
       [ngClass]="{
         'fa-check-circle': !job.withdrawn,
         'fa-ban': job.withdrawn
       }"></i>
    {{ job.withdrawn ? 'Withdrawn' : 'Applied' }}
  </span>

                  
                </div>
              </div>
            </article>
          </div>
        </ng-container>

        <!-- No Jobs Template -->
        <ng-template #noJobs>
          <div class="empty-state text-center py-5" *ngIf="!loading">
            <div class="empty-icon mb-3">
              <i class="fas fa-file-alt fa-3x text-muted"></i>
            </div>
            <h3 class="h5">No applications yet</h3>
            <p class="text-muted mb-4">Your applied jobs will appear here once you start applying</p>
            <a routerLink="/jobs" class="btn btn-primary">
              <i class="fas fa-search mr-2"></i>Browse Jobs
            </a>
          </div>
        </ng-template>

        <!-- Loading Indicator -->
        <div *ngIf="loading" class="loading-indicator text-center py-5">
          <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="sr-only">Loading applied jobs...</span>
          </div>
          <p class="mt-3 text-muted">Loading your applications...</p>
        </div>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>
<app-back-to-top></app-back-to-top>
